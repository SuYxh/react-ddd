è¿™æ˜¯ä¸€ä¸ªéå¸¸å…¸å‹ã€å¾ˆâ€œå‰ç«¯å®é™…â€çš„é—®é¢˜ï¼š åŒä¸€ä¸ªä¸šåŠ¡æ¨¡å‹ï¼ˆå¦‚ `Product`ï¼‰ï¼Œä½† PC å’Œ App **ä½¿ç”¨ä¸åŒçš„æ¥å£æˆ–æ•°æ®æ ¼å¼**ï¼Œå¦‚ä½•ä¼˜é›…æ”¯æŒï¼Ÿ



## ğŸ¯ åœºæ™¯ä¸¾ä¾‹

| åœºæ™¯     | PC æ¥å£                         | App æ¥å£               |
| -------- | ------------------------------- | ---------------------- |
| å•†å“è¯¦æƒ… | `/api/pc/product/detail?id=xxx` | `/api/app/product/:id` |
| è¿”å›ç»“æ„ | `data.product`                  | `data`                 |
| å­—æ®µä¸åŒ | `price_cents`                   | `price`ï¼ˆå•ä½ï¼šå…ƒï¼‰    |



## âœ… æ­£ç¡®å¤„ç†æ–¹å¼ï¼ˆDDD + å¤šç«¯å¤ç”¨ï¼‰

> æŠ½è±¡ Repository å±‚ï¼Œå°è£…å¤šç«¯å·®å¼‚é€»è¾‘ï¼Œç»Ÿä¸€è¾“å‡ºé¢†åŸŸæ¨¡å‹



### âœ… æ­¥éª¤æ¦‚è§ˆï¼š

1. å®šä¹‰é¢†åŸŸæ¨¡å‹ `Product`
2. å®šä¹‰æ¥å£ `ProductRepository`ï¼Œéšè—æ•°æ®æºç»†èŠ‚
3. åœ¨å„å¹³å°æ³¨å…¥è‡ªå·±çš„ repository å®ç°ï¼ˆå¦‚ PC / Appï¼‰
4. application å±‚ç»Ÿä¸€é€šè¿‡æ¥å£ä½¿ç”¨ï¼Œæ— æ„ŸçŸ¥å·®å¼‚



## ğŸ§± å®ç°ä»£ç ç»“æ„ç¤ºä¾‹



### 1ï¸âƒ£ å®šä¹‰é¢†åŸŸæ¨¡å‹ï¼ˆdomainï¼‰

```ts
// features/product/domain/Product.ts
export class Product {
  constructor(
    public readonly id: string,
    public readonly name: string,
    public readonly price: number, // ç»Ÿä¸€ä¸ºå…ƒ
  ) {}

  getFormattedPrice(): string {
    return `Â¥${this.price.toFixed(2)}`;
  }
}
```



### 2ï¸âƒ£ æŠ½è±¡ä»“å‚¨æ¥å£ï¼ˆinfrastructureï¼‰

```ts
// features/product/infrastructure/productRepository.ts
import { Product } from '../../product/domain/Product';

export interface ProductRepository {
  getById(id: string): Promise<Product>;
}

let impl: ProductRepository | null = null;

export const productRepository = {
  register: (r: ProductRepository) => {
    impl = r;
  },
  get: (): ProductRepository => {
    if (!impl) throw new Error('[ProductRepository] not registered');
    return impl;
  },
};
```



### 3ï¸âƒ£ å¹³å°é€‚é…å®ç°ï¼ˆPC ç¤ºä¾‹ï¼‰

```ts
// platforms/pc/productRepositoryImpl.ts
import { productRepository } from '../../features/product/infrastructure/productRepository';
import { Product } from '../../features/product/domain/Product';

productRepository.register({
  async getById(id: string): Promise<Product> {
    const res = await fetch(`/api/pc/product/detail?id=${id}`);
    const data = await res.json();
    const raw = data.product;

    return new Product(raw.id, raw.name, raw.price_cents / 100);
  },
});
```



### App ç«¯å®ç°ï¼ˆå­—æ®µç»“æ„ä¸åŒï¼‰

```ts
// platforms/mobile/productRepositoryImpl.ts
import { productRepository } from '../../features/product/infrastructure/productRepository';
import { Product } from '../../features/product/domain/Product';

productRepository.register({
  async getById(id: string): Promise<Product> {
    const res = await fetch(`/api/app/product/${id}`);
    const data = await res.json();

    return new Product(data.id, data.title, data.price); // App ç«¯è¿”å› price = å…ƒ
  },
});
```



### 4ï¸âƒ£ åº”ç”¨æœåŠ¡å±‚ä½¿ç”¨

```ts
// application/useProductService.ts
import { productRepository } from '../../features/product/infrastructure/productRepository';

export const useProductService = () => {
  const getProductDetail = async (id: string) => {
    return await productRepository.get().getById(id);
  };

  return { getProductDetail };
};
```



### 5ï¸âƒ£ UI å±‚è°ƒç”¨ç»Ÿä¸€æœåŠ¡

```tsx
const { getProductDetail } = useProductService();

useEffect(() => {
  getProductDetail(productId).then(setProduct);
}, []);
```



## âœ… å¥½å¤„æ€»ç»“

| ç‚¹                     | è¯´æ˜                                          |
| ---------------------- | --------------------------------------------- |
| ğŸ§© æ¯ç«¯æ•°æ®å·®å¼‚å®Œå…¨éšè— | ç”±å„å¹³å°æ³¨å†Œçš„ Repository å®ç°å†³å®š            |
| âœ… åº”ç”¨æœåŠ¡å±‚ä¸æ”¹       | `getProductDetail(id)` æ— éœ€ç®¡æ¥å£æ ¼å¼         |
| âœ… é¢†åŸŸæ¨¡å‹ç»Ÿä¸€         | ä¸åŒå¹³å°éƒ½è¾“å‡º `Product` å®ä½“                 |
| ğŸ”Œ çµæ´»æ‰©å±•             | åæœŸæ–°å¢ web3ã€å°ç¨‹åºå¹³å°ä¹Ÿåªéœ€æ–°å¢ä¸€ä¸ªæ³¨å†Œå™¨ |
| ğŸ§ª å¯æµ‹                 | Repository å¯ mockï¼Œå®ç°æµ‹è¯•éš”ç¦»              |



## ğŸ” ç±»ä¼¼åœºæ™¯ä¹Ÿé€‚ç”¨ï¼š

- ç”¨æˆ·ä¿¡æ¯æ¥å£ï¼ˆApp/PC è¿”å›ä¸åŒå­—æ®µï¼‰
- å•†å“åˆ—è¡¨åˆ†é¡µï¼ˆé¡µç  / æ¸¸æ ‡ï¼‰
- æœç´¢å»ºè®®ï¼ˆè¿”å›æ ¼å¼å·®å¼‚ï¼‰



## ğŸ“Œ æœ€ä½³å®è·µæ€»ç»“

| é—®é¢˜             | åšæ³•                                               |
| ---------------- | -------------------------------------------------- |
| å¤šç«¯æ¥å£ä¸ä¸€è‡´   | Repository å°è£…å¹³å°å·®å¼‚é€»è¾‘                        |
| å¤šç«¯å­—æ®µç»“æ„ä¸åŒ | åœ¨å„å¹³å°ä¸­åšå­—æ®µæ˜ å°„ï¼Œè¾“å‡ºç»Ÿä¸€é¢†åŸŸæ¨¡å‹             |
| å¤šç«¯ä¸šåŠ¡è¡Œä¸ºä¸åŒ | ä½¿ç”¨ `platformStrategy` æ³¨å…¥è¡Œä¸ºå·®å¼‚ï¼ˆè·³è½¬ã€å¼¹çª—ï¼‰ |

